


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="ko" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="ko" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta property="og:title" content="Pytorch와 TIAToolbox를 사용한 전체 슬라이드 이미지(Whole Slide Image) 분류" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://tutorials.pytorch.kr/intermediate/tiatoolbox_tutorial.html" />
<meta property="og:site_name" content="PyTorch Tutorials KR" />
<meta property="og:description" content="번역: 박주환 개요: 본 튜토리얼에서는 TIAToolbox를 사용한 PyTorch 모델을 통해 전체 슬라이드 이미지들(Whole Slide Images, WSIs)을 분류하는 방법을 알아보겠습니다. WSI란 수술이나 생검을 통해 채취된 인간 조직 샘플의 이미지이며, 이러한 이미지는 전문 스캐너를 이용해 스캔 됩니다. 이 데이터는 병리학자와 전산 병리학자들이 종양 성장에 대한 이해를 높이고 환자 치료를 개선하기 위해 암과 같은 질병을 미시적 수준에서 연구 하는데 사용됩니다. WSIs를 처리하는 것이 어려운 이유는 엄청난 크기 때..." />
<meta property="og:image" content="https://tutorials.pytorch.kr/_static/logos/logo-kr-sm-dark.png" />
<meta property="og:image:alt" content="PyTorch Tutorials KR" />
<meta name="description" content="번역: 박주환 개요: 본 튜토리얼에서는 TIAToolbox를 사용한 PyTorch 모델을 통해 전체 슬라이드 이미지들(Whole Slide Images, WSIs)을 분류하는 방법을 알아보겠습니다. WSI란 수술이나 생검을 통해 채취된 인간 조직 샘플의 이미지이며, 이러한 이미지는 전문 스캐너를 이용해 스캔 됩니다. 이 데이터는 병리학자와 전산 병리학자들이 종양 성장에 대한 이해를 높이고 환자 치료를 개선하기 위해 암과 같은 질병을 미시적 수준에서 연구 하는데 사용됩니다. WSIs를 처리하는 것이 어려운 이유는 엄청난 크기 때..." />
<meta property="og:ignore_canonical" content="true" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Pytorch와 TIAToolbox를 사용한 전체 슬라이드 이미지(Whole Slide Image) 분류 &mdash; 파이토치 한국어 튜토리얼 (PyTorch tutorials in Korean)</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!-- <link rel="stylesheet" href="../_static/pygments.css" type="text/css" /> -->
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/katex-math.css" type="text/css" />
  <link rel="stylesheet" href="../_static/sg_gallery.css" type="text/css" />
  <link rel="stylesheet" href="../_static/sg_gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../_static/sg_gallery-dataframe.css" type="text/css" />
  <link rel="stylesheet" href="../_static/sg_gallery-rendered-html.css" type="text/css" />
  <link rel="stylesheet" href="../_static/sphinx-design.5ea377869091fd0449014c60fc090103.min.css" type="text/css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/katex.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom2.css" type="text/css" />
    <link rel="index" title="색인" href="../genindex.html" />
    <link rel="search" title="검색" href="../search.html" />
    <link rel="next" title="Audio I/O" href="../beginner/audio_io_tutorial.html" />
    <link rel="prev" title="배포를 위해 비전 트랜스포머(Vision Transformer) 모델 최적화하기" href="../beginner/vt_tutorial.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

  <!-- Preload the theme fonts -->

<link rel="preload" href="../_static/fonts/FreightSans/freight-sans-book.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/FreightSans/freight-sans-medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/IBMPlexMono/IBMPlexMono-Medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/FreightSans/freight-sans-bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/FreightSans/freight-sans-medium-italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/IBMPlexMono/IBMPlexMono-SemiBold.woff2" as="font" type="font/woff2" crossorigin="anonymous">

<!-- Preload the katex fonts -->

<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Math-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size1-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size4-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size2-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size3-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Caligraphic-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css" integrity="sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu" crossorigin="anonymous">
</head>

<div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">
    <div class="header-container">
      <a class="header-logo" href="https://pytorch.kr/" aria-label="PyTorch"></a>

      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pytorch.kr/get-started">시작하기</a>
          </li>

          <li class="active">
            <a href="https://tutorials.pytorch.kr/">튜토리얼</a>
          </li>

          <li>
            <a href="https://pytorch.kr/hub">허브</a>
          </li>

          <li>
            <a href="https://discuss.pytorch.kr/">커뮤니티</a>
          </li>
        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
    </div>
  </div>
</div>

<body class="pytorch-body">

   

    

    <div class="table-of-contents-link-wrapper">
      <span>Table of Contents</span>
      <a href="#" class="toggle-table-of-contents" data-behavior="toggle-table-of-contents"></a>
    </div>

    <nav data-toggle="wy-nav-shift" class="pytorch-left-menu" id="pytorch-left-menu">
      <div class="pytorch-side-scroll">
        <div class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          <div class="pytorch-left-menu-search">
            

            
              
              
                <div class="version">
                  2.3.1
                </div>
              
            

            


  


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search Tutorials" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

            
          </div>

          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">파이토치(PyTorch) 레시피</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../recipes/recipes_index.html">모든 레시피 보기</a></li>
<li class="toctree-l1"><a class="reference internal" href="../prototype/prototype_index.html">모든 프로토타입 레시피 보기</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">파이토치(PyTorch) 시작하기</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../beginner/basics/intro.html">파이토치(PyTorch) 기본 익히기</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/basics/quickstart_tutorial.html">빠른 시작(Quickstart)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/basics/tensorqs_tutorial.html">텐서(Tensor)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/basics/data_tutorial.html">Dataset과 DataLoader</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/basics/transforms_tutorial.html">변형(Transform)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/basics/buildmodel_tutorial.html">신경망 모델 구성하기</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/basics/autogradqs_tutorial.html"><code class="docutils literal notranslate"><span class="pre">torch.autograd</span></code>를 사용한 자동 미분</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/basics/optimization_tutorial.html">모델 매개변수 최적화하기</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/basics/saveloadrun_tutorial.html">모델 저장하고 불러오기</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Introduction to PyTorch on YouTube</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../beginner/introyt.html">PyTorch 소개 - YouTube 시리즈</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/introyt/introyt1_tutorial.html">PyTorch 소개</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/introyt/tensors_deeper_tutorial.html">Pytorch Tensor 소개</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/introyt/autogradyt_tutorial.html">The Fundamentals of Autograd</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/introyt/modelsyt_tutorial.html">Building Models with PyTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/introyt/tensorboardyt_tutorial.html">PyTorch TensorBoard 지원</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/introyt/trainingyt.html">Training with PyTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/introyt/captumyt.html">Model Understanding with Captum</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">파이토치(PyTorch) 배우기</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../beginner/deep_learning_60min_blitz.html">PyTorch로 딥러닝하기: 60분만에 끝장내기</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/pytorch_with_examples.html">예제로 배우는 파이토치(PyTorch)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/nn_tutorial.html"><cite>torch.nn</cite> 이 <em>실제로</em> 무엇인가요?</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensorboard_tutorial.html">TensorBoard로 모델, 데이터, 학습 시각화하기</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">이미지/비디오</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="torchvision_tutorial.html">TorchVision Object Detection Finetuning Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/transfer_learning_tutorial.html">컴퓨터 비전(Vision)을 위한 전이학습(Transfer Learning)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/fgsm_tutorial.html">적대적 예제 생성(Adversarial Example Generation)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/dcgan_faces_tutorial.html">DCGAN 튜토리얼</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/vt_tutorial.html">배포를 위해 비전 트랜스포머(Vision Transformer) 모델 최적화하기</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Pytorch와 TIAToolbox를 사용한 전체 슬라이드 이미지(Whole Slide Image) 분류</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">오디오</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../beginner/audio_io_tutorial.html">Audio I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/audio_resampling_tutorial.html">Audio Resampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/audio_data_augmentation_tutorial.html">Audio Data Augmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/audio_feature_extractions_tutorial.html">Audio Feature Extractions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/audio_feature_augmentation_tutorial.html">Audio Feature Augmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/audio_datasets_tutorial.html">오디오 데이터셋</a></li>
<li class="toctree-l1"><a class="reference internal" href="speech_recognition_pipeline_tutorial.html">Speech Recognition with Wav2Vec2</a></li>
<li class="toctree-l1"><a class="reference internal" href="text_to_speech_with_torchaudio.html">Text-to-speech with Tacotron2</a></li>
<li class="toctree-l1"><a class="reference internal" href="forced_alignment_with_torchaudio_tutorial.html">wav2vec2을 이용한 강제 정렬</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">텍스트</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../beginner/bettertransformer_tutorial.html">Better Transformer를 이용한 고속 트랜스포머 추론</a></li>
<li class="toctree-l1"><a class="reference internal" href="char_rnn_classification_tutorial.html">기초부터 시작하는 NLP: 문자-단위 RNN으로 이름 분류하기</a></li>
<li class="toctree-l1"><a class="reference internal" href="char_rnn_generation_tutorial.html">기초부터 시작하는 NLP:  문자-단위 RNN으로 이름 생성하기</a></li>
<li class="toctree-l1"><a class="reference internal" href="seq2seq_translation_tutorial.html">기초부터 시작하는 NLP: Sequence to Sequence 네트워크와 Attention을 이용한 번역</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/text_sentiment_ngrams_tutorial.html">torchtext 라이브러리로 텍스트 분류하기</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/translation_transformer.html"><code class="docutils literal notranslate"><span class="pre">nn.Transformer</span></code> 와 torchtext로 언어 번역하기</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/torchtext_custom_dataset_tutorial.html">TorchText를 사용하여 사용자 정의 글 데이터셋 전처리하기</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">백엔드</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../beginner/onnx/intro_onnx.html">Introduction to ONNX</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">강화학습</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="reinforcement_q_learning.html">강화 학습 (DQN) 튜토리얼</a></li>
<li class="toctree-l1"><a class="reference internal" href="reinforcement_ppo.html">Reinforcement Learning (PPO) with TorchRL Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="mario_rl_tutorial.html">마리오 게임 RL 에이전트로 학습하기</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/pendulum.html">Pendulum: Writing your environment and transforms with TorchRL</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">PyTorch 모델을 프로덕션 환경에 배포하기</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../beginner/onnx/intro_onnx.html">Introduction to ONNX</a></li>
<li class="toctree-l1"><a class="reference internal" href="flask_rest_api_tutorial.html">Flask를 사용하여 Python에서 PyTorch를 REST API로 배포하기</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/Intro_to_TorchScript_tutorial.html">TorchScript 소개</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/cpp_export.html">C++에서 TorchScript 모델 로딩하기</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/super_resolution_with_onnxruntime.html">(선택) PyTorch 모델을 ONNX으로 변환하고 ONNX 런타임에서 실행하기</a></li>
<li class="toctree-l1"><a class="reference internal" href="realtime_rpi.html">Raspberry Pi 4 에서 실시간 추론(Inference) (30fps!)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">PyTorch 프로파일링</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../beginner/profiler.html">PyTorch 모듈 프로파일링하기</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/hta_intro_tutorial.html">전체론적(Holistic Trace Analysis) 추적 분석 소개</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/hta_trace_diff_tutorial.html">종합적 분석을 이용한 트레이스 차이 분석</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Code Transforms with FX</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="fx_conv_bn_fuser.html">(베타) FX에서 합성곱/배치 정규화(Convolution/Batch Norm) 결합기(Fuser) 만들기</a></li>
<li class="toctree-l1"><a class="reference internal" href="fx_profiling_tutorial.html">(beta) Building a Simple CPU Performance Profiler with FX</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">프론트엔드 API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="memory_format_tutorial.html">(베타) PyTorch를 사용한 Channels Last 메모리 형식</a></li>
<li class="toctree-l1"><a class="reference internal" href="forward_ad_usage.html">Forward-mode Automatic Differentiation (Beta)</a></li>
<li class="toctree-l1"><a class="reference internal" href="jacobians_hessians.html">Jacobians, Hessians, hvp, vhp, and more: composing function transforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="ensembling.html">모델 앙상블</a></li>
<li class="toctree-l1"><a class="reference internal" href="per_sample_grads.html">Per-sample-gradients</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/cpp_frontend.html">PyTorch C++ 프론트엔드 사용하기</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/torch-script-parallelism.html">TorchScript의 동적 병렬 처리(Dynamic Parallelism)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/cpp_autograd.html">C++ 프론트엔드의 자동 미분 (autograd)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">PyTorch 확장하기</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="custom_function_double_backward_tutorial.html">Double Backward with Custom Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom_function_conv_bn_tutorial.html">Fusing Convolution and Batch Norm using Custom Function</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/cpp_extension.html">Custom C++ and CUDA Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/torch_script_custom_ops.html">Extending TorchScript with Custom C++ Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/torch_script_custom_classes.html">커스텀 C++ 클래스로 TorchScript 확장하기</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/dispatcher.html">Registering a Dispatched Operator in C++</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/extend_dispatcher.html">Extending dispatcher for a new backend in C++</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/privateuseone.html">Facilitating New Backend Integration by PrivateUse1</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">모델 최적화</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../beginner/profiler.html">PyTorch 모듈 프로파일링하기</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensorboard_profiler_tutorial.html">텐서보드를 이용한 파이토치 프로파일러</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/hyperparameter_tuning_tutorial.html">Ray Tune을 사용한 하이퍼파라미터 튜닝</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/vt_tutorial.html">배포를 위해 비전 트랜스포머(Vision Transformer) 모델 최적화하기</a></li>
<li class="toctree-l1"><a class="reference internal" href="parametrizations.html">Parametrizations Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="pruning_tutorial.html">가지치기 기법(Pruning) 튜토리얼</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/dynamic_quantization_tutorial.html">(베타) LSTM 기반 단어 단위 언어 모델의 동적 양자화</a></li>
<li class="toctree-l1"><a class="reference internal" href="dynamic_quantization_bert_tutorial.html">(베타) BERT 모델 동적 양자화하기</a></li>
<li class="toctree-l1"><a class="reference internal" href="quantized_transfer_learning_tutorial.html">(베타) 컴퓨터 비전 튜토리얼을 위한 양자화된 전이학습(Quantized Transfer Learning)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/static_quantization_tutorial.html">(베타) PyTorch에서 Eager Mode를 이용한 정적 양자화</a></li>
<li class="toctree-l1"><a class="reference internal" href="torchserve_with_ipex.html">Grokking PyTorch Intel CPU performance from first principles</a></li>
<li class="toctree-l1"><a class="reference internal" href="torchserve_with_ipex_2.html">Grokking PyTorch Intel CPU performance from first principles (Part 2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="nvfuser_intro_tutorial.html">Getting Started - Accelerate Your Scripts with nvFuser</a></li>
<li class="toctree-l1"><a class="reference internal" href="ax_multiobjective_nas_tutorial.html">Multi-Objective NAS with Ax</a></li>
<li class="toctree-l1"><a class="reference internal" href="torch_compile_tutorial.html">Introduction to <code class="docutils literal notranslate"><span class="pre">torch.compile</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="inductor_debug_cpu.html">Inductor CPU backend debugging and profiling</a></li>
<li class="toctree-l1"><a class="reference internal" href="scaled_dot_product_attention_tutorial.html">(Beta) Scaled Dot Product Attention (SDPA)로 고성능 트랜스포머(Transformers) 구현하기</a></li>
<li class="toctree-l1"><a class="reference internal" href="scaled_dot_product_attention_tutorial.html#torch-compile-sdpa"><code class="docutils literal notranslate"><span class="pre">torch.compile</span></code> 과 함께 SDPA 사용하기</a></li>
<li class="toctree-l1"><a class="reference internal" href="scaled_dot_product_attention_tutorial.html#sdpa-atteition-bias">SDPA를 <code class="docutils literal notranslate"><span class="pre">atteition.bias</span></code> 하위 클래스와 사용하기</a></li>
<li class="toctree-l1"><a class="reference internal" href="scaled_dot_product_attention_tutorial.html#id8">결론</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/knowledge_distillation_tutorial.html">Knowledge Distillation Tutorial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">병렬 및 분산 학습</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../distributed/home.html">Distributed and Parallel Training Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/dist_overview.html">PyTorch Distributed Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/ddp_series_intro.html">PyTorch의 분산 데이터 병렬 처리 - 비디오 튜토리얼</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_parallel_tutorial.html">단일 머신을 사용한 모델 병렬화 모범 사례</a></li>
<li class="toctree-l1"><a class="reference internal" href="ddp_tutorial.html">분산 데이터 병렬 처리 시작하기</a></li>
<li class="toctree-l1"><a class="reference internal" href="dist_tuto.html">PyTorch로 분산 어플리케이션 개발하기</a></li>
<li class="toctree-l1"><a class="reference internal" href="FSDP_tutorial.html">Fully Sharded Data Parallel(FSDP) 시작하기</a></li>
<li class="toctree-l1"><a class="reference internal" href="FSDP_adavnced_tutorial.html">Advanced Model Training with Fully Sharded Data Parallel (FSDP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="TP_tutorial.html">Large Scale Transformer model training with Tensor Parallel (TP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="process_group_cpp_extension_tutorial.html">Cpp 확장을 사용한 프로세스 그룹 백엔드 사용자 정의</a></li>
<li class="toctree-l1"><a class="reference internal" href="rpc_tutorial.html">Getting Started with Distributed RPC Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="rpc_param_server_tutorial.html">Implementing a Parameter Server Using Distributed RPC Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="dist_pipeline_parallel_tutorial.html">Distributed Pipeline Parallelism Using RPC</a></li>
<li class="toctree-l1"><a class="reference internal" href="rpc_async_execution.html">Implementing Batch RPC Processing Using Asynchronous Executions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/rpc_ddp_tutorial.html">분산 데이터 병렬(DDP)과 분산 RPC 프레임워크 결합</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/ddp_pipeline.html">분산 데이터 병렬 처리와 병렬 처리 파이프라인을 사용한 트랜스포머 모델 학습</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/generic_join.html">Distributed Training with Uneven Inputs Using the Join Context Manager</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Edge with ExecuTorch</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/executorch/stable/tutorials/export-to-executorch-tutorial.html">Exporting to ExecuTorch Tutorial</a></li>
<li class="toctree-l1"><a class="reference external" href=" https://pytorch.org/executorch/stable/running-a-model-cpp-tutorial.html">Running an ExecuTorch Model in C++ Tutorial</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/executorch/stable/tutorials/sdk-integration-tutorial.html">Using the ExecuTorch SDK to Profile a Model</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/executorch/stable/demo-apps-ios.html">Building an ExecuTorch iOS Demo App</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/executorch/stable/demo-apps-android.html">Building an ExecuTorch Android Demo App</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/executorch/stable/examples-end-to-end-to-lower-model-to-delegate.html">Lowering a Model as a Delegate</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">추천 시스템</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="torchrec_tutorial.html">TorchRec 소개</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/sharding.html">Exploring TorchRec sharding</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Multimodality</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../beginner/flava_finetuning_tutorial.html">TorchMultimodal 튜토리얼: FLAVA 미세조정</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <div class="pytorch-container">
      <div class="pytorch-page-level-bar" id="pytorch-page-level-bar">
        <div class="pytorch-breadcrumbs-wrapper">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="pytorch-breadcrumbs">
    
      <li>
        <a href="../index.html">
          
            Tutorials
          
        </a> &gt;
      </li>

        
      <li>Pytorch와 TIAToolbox를 사용한 전체 슬라이드 이미지(Whole Slide Image) 분류</li>
    
    
      <li class="pytorch-breadcrumbs-aside">
        
            
            <a href="../_sources/intermediate/tiatoolbox_tutorial.rst.txt" rel="nofollow"><img src="../_static/images/view-page-source-icon.svg"></a>
          
        
      </li>
    
  </ul>

  
</div>
        </div>

        <div class="pytorch-shortcuts-wrapper" id="pytorch-shortcuts-wrapper">
          Shortcuts
        </div>
      </div>

      <section data-toggle="wy-nav-shift" id="pytorch-content-wrap" class="pytorch-content-wrap">
        <div class="pytorch-content-left">

        

          <div class="pytorch-call-to-action-links">
            <div id="tutorial-type">intermediate/tiatoolbox_tutorial</div>

            <div id="google-colab-link">
              <img class="call-to-action-img" src="../_static/images/pytorch-colab.svg"/>
              <div class="call-to-action-desktop-view">Run in Google Colab</div>
              <div class="call-to-action-mobile-view">Colab</div>
            </div>
            <div id="download-notebook-link">
              <img class="call-to-action-notebook-img" src="../_static/images/pytorch-download.svg"/>
              <div class="call-to-action-desktop-view">Download Notebook</div>
              <div class="call-to-action-mobile-view">Notebook</div>
            </div>
            <div id="github-view-link">
              <img class="call-to-action-img" src="../_static/images/pytorch-github.svg"/>
              <div class="call-to-action-desktop-view">View on GitHub</div>
              <div class="call-to-action-mobile-view">GitHub</div>
            </div>
          </div>

        

          
          <div class="rst-content">
          
            <div role="main" class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article">
             <article itemprop="articleBody" id="pytorch-article" class="pytorch-article">
              
  <div class="section" id="pytorch-tiatoolbox-whole-slide-image">
<h1>Pytorch와 TIAToolbox를 사용한 전체 슬라이드 이미지(Whole Slide Image) 분류<a class="headerlink" href="#pytorch-tiatoolbox-whole-slide-image" title="이 제목에 대한 퍼머링크">¶</a></h1>
<p><strong>번역</strong>: <a class="reference external" href="https://github.com/jkworldchampion">박주환</a></p>
<div class="admonition tip">
<p class="admonition-title">팁</p>
<p>이 튜토리얼을 최대한 활용하려면, 이 <a class="reference external" href="https://colab.research.google.com/github/pytorch/tutorials/blob/main/_static/tiatoolbox_tutorial.ipynb">Colab 버전</a> 을
사용하는 것을 권장합니다. 이를 통해 아래의 자료를 실험해 볼 수 있습니다.</p>
</div>
<div class="section" id="id2">
<h2>개요<a class="headerlink" href="#id2" title="이 제목에 대한 퍼머링크">¶</a></h2>
<p>본 튜토리얼에서는 TIAToolbox를 사용한 PyTorch 모델을 통해
전체 슬라이드 이미지들(Whole Slide Images, WSIs)을 분류하는
방법을 알아보겠습니다. WSI란 수술이나 생검을 통해 채취된 인간
조직 샘플의 이미지이며, 이러한 이미지는 전문 스캐너를 이용해
스캔 됩니다. 이 데이터는 병리학자와 전산 병리학자들이
종양 성장에 대한 이해를 높이고 환자 치료를 개선하기 위해
<a class="reference external" href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7522141/">암과 같은 질병을 미시적 수준에서 연구</a>
하는데 사용됩니다.</p>
<p>WSIs를 처리하는 것이 어려운 이유는 엄청난 크기 때문입니다. 예컨대,
일반적인 슬라이드 이미지가 <a class="reference external" href="https://doi.org/10.1117%2F12.912388">100,000x100,000
픽셀</a> 정도의 크기를 가지며,
각 픽셀은 슬라이드 상에서 약 0.25x0.25 마이크로미터에 해당합니다.
이 때문에 이미지를 로드하고 처리하는 데 어려움을 야기하며, 한 연구에서
수백 개나 수천 개의 WSIs가 포함되는 경우는 말할 것도 없습니다
더 큰 연구가 더 나은 결과를 제공합니다!</p>
<p>전통적인 이미지 처리 파이프라인은 WSIs 처리에
적합하지 않으므로 더 나은 도구가 필요합니다.
이때, <a class="reference external" href="https://github.com/TissueImageAnalytics/tiatoolbox">TIAToolbox</a> 가
도움이 될 수 있는데, 이는 조직 슬라이드(tissue slides)를 빠르고
효율적으로 처리할 수 있는 유용한 도구들을 제공합니다.
일반적으로 WSIs는 시각화에 최적화된
다양한 배율에서 동일한 이미지의 여러 복사본이 피라미드 구조로 저장됩니다.
피라미드의 레벨 0(또는 가장 아래 단계)에는 가장 높은
배율 또는 줌 수준의 이미지를 포함하며,
피라미드의 상위 단계로 갈수록 기본 이미지의 저 해상도 사본이 있습니다.
하단에 피라미드의 구조가 그려져 있습니다.</p>
<p><img alt="WSI pyramid stack" src="../_images/read_bounds_tissue.webp" /> <em>WSI 피라미드 stack
(</em><a class="reference external" href="https://tia-toolbox.readthedocs.io/en/latest/_autosummary/tiatoolbox.wsicore.wsireader.WSIReader.html#">source</a><em>)</em></p>
<p>TIAToolbox를 사용하면 <a class="reference external" href="https://doi.org/10.1016/j.media.2022.102685">조직
분류</a> 와 같은 일반적인
후속 분석 작업을 자동화할 수 있습니다. 본 튜토리얼에서는 다음을 수행하는
방법을 보여줍니다: 1. TIAToolbox를 사용하여 WSI(Whole Slide Image)를
이미지를 로드하는 방법 2. 서로 다른 Pytorch 모델을 사용하여 슬라이드를
패치 레벨(patch-level)에서 분류하는 방법. 본 튜토리얼에서는 TorchVision의
<code class="docutils literal notranslate"><span class="pre">ResNet18</span></code> 모델과 커스텀(custom) <a class="reference external" href="https://github.com/jopo666/HistoEncoder">HistoEncoder</a>
모델을 사용하는 예제를 제공합니다.</p>
<p>시작해보자!</p>
</div>
<div class="section" id="id3">
<h2>환경설정<a class="headerlink" href="#id3" title="이 제목에 대한 퍼머링크">¶</a></h2>
<p>본 튜토리얼에서 제공하는 예제를 실행하려면, 다음과 같은 패키지(packages)가
필요합니다.</p>
<ol class="arabic simple">
<li><p>OpenJpeg</p></li>
<li><p>OpenSlide</p></li>
<li><p>Pixman</p></li>
<li><p>TIAToolbox</p></li>
<li><p>HistoEncoder (for a custom model example)</p></li>
</ol>
<p>이 패키지들을 설치하기 위해 터미널(terminal)에 아래의
명령어를 실행해주세요:</p>
<ul class="simple">
<li><p><cite>apt-get -y -qq install libopenjp2-7-dev libopenjp2-tools openslide-tools libpixman-1-dev</cite></p></li>
<li><p><cite>pip install -q 〈tiatoolbox&lt;1.5〉 histoencoder &amp;&amp; echo 《Installation is done.》</cite></p></li>
</ul>
<p>또한, MacOS에서는 <code class="docutils literal notranslate"><span class="pre">apt-get</span></code> 대신에 <code class="docutils literal notranslate"><span class="pre">brew</span> <span class="pre">install</span> <span class="pre">openjpeg</span> <span class="pre">openslide</span></code>
명령어를 실행하여 필수 패키지들을 설치할 수 있습니다.
설치에 대한 추가 정보는 <a class="reference external" href="https://tia-toolbox.readthedocs.io/en/latest/installation.html">여기</a>
를 참조하세요.</p>
<div class="section" id="id4">
<h3>관련 라이브러리 불러오기<a class="headerlink" href="#id4" title="이 제목에 대한 퍼머링크">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Jupyter 노트북을 실행하는 데 필요한 모듈 불러오기.&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="c1"># 로깅(logging) 설정하기</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="k">if</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">hasHandlers</span><span class="p">():</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;.*The &#39;nopython&#39; keyword.*&quot;</span><span class="p">)</span>

<span class="c1"># 데이터와 파일 다운로드하기</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">zipfile</span> <span class="kn">import</span> <span class="n">ZipFile</span>

<span class="c1"># 데이터 처리 및 시각화</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>
<span class="kn">import</span> <span class="nn">PIL</span>
<span class="kn">import</span> <span class="nn">contextlib</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">confusion_matrix</span>

<span class="c1"># WSI 로딩 및 처리를 위한 TIAToolbox</span>
<span class="kn">from</span> <span class="nn">tiatoolbox</span> <span class="kn">import</span> <span class="n">logger</span>
<span class="kn">from</span> <span class="nn">tiatoolbox.models.architecture</span> <span class="kn">import</span> <span class="n">vanilla</span>
<span class="kn">from</span> <span class="nn">tiatoolbox.models.engine.patch_predictor</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">IOPatchPredictorConfig</span><span class="p">,</span>
    <span class="n">PatchPredictor</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">tiatoolbox.utils.misc</span> <span class="kn">import</span> <span class="n">download_data</span><span class="p">,</span> <span class="n">grab_files_from_dir</span>
<span class="kn">from</span> <span class="nn">tiatoolbox.utils.visualization</span> <span class="kn">import</span> <span class="n">overlay_prediction_mask</span>
<span class="kn">from</span> <span class="nn">tiatoolbox.wsicore.wsireader</span> <span class="kn">import</span> <span class="n">WSIReader</span>

<span class="c1"># Torch-관련</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torchvision</span> <span class="kn">import</span> <span class="n">transforms</span>

<span class="c1"># 그래프 설정</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.dpi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">160</span>  <span class="c1"># for high resolution figure in notebook</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.facecolor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span>  <span class="c1"># To make sure text is visible in dark mode</span>

<span class="c1"># 만약 GPU를 사용하지 않는다면, ON_GPU를 False로 변경하세요.</span>
<span class="n">ON_GPU</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># 장황한 코드 블록의 콘솔 출력을 억제하는 함수</span>
<span class="k">def</span> <span class="nf">suppress_console_output</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">redirect_stderr</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="clean-up">
<h3>실행 전 정리(clean-up)<a class="headerlink" href="#clean-up" title="이 제목에 대한 퍼머링크">¶</a></h3>
<p>적절한 정리를 보장하기 위해(예컨대, 비정상 종료), 이번 실행에서
다운로드되거나 생성된 모든 파일은 <code class="docutils literal notranslate"><span class="pre">global_save_dir</span></code> 이라는
하나의 디렉토리에 저장되며, 이 디렉토리는 “./tmp/”로 설정됩니다.
유지보수를 쉽게 하기 위해 디렉토리 이름은 이 한 곳에서만 설정되므로,
필요하면 간편하게 변경할 수 있습니다.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
<span class="n">global_save_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;./tmp/&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">rmdir</span><span class="p">(</span><span class="n">dir_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;디렉토리를 지우기 위한 도우미 함수&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Removing directory </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">)</span>


<span class="n">rmdir</span><span class="p">(</span><span class="n">global_save_dir</span><span class="p">)</span>  <span class="c1"># 이전 실행에서 디렉토리가 있는 경우 삭제</span>
<span class="n">global_save_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating new directory </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">global_save_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h3>데이터 다운로드<a class="headerlink" href="#id5" title="이 제목에 대한 퍼머링크">¶</a></h3>
<p>샘플 데이터로는 전체 슬라이드 이미지(whole-slide image)를 사용하고
<a class="reference external" href="https://zenodo.org/record/1214456#.YJ-tn3mSkuU">Kather 100k</a> 데이터셋의
검증(validation) 하위 집단(subset)에서 추출한 패치들을 사용할 것입니다.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">wsi_path</span> <span class="o">=</span> <span class="n">global_save_dir</span> <span class="o">/</span> <span class="s2">&quot;sample_wsi.svs&quot;</span>
<span class="n">patches_path</span> <span class="o">=</span> <span class="n">global_save_dir</span> <span class="o">/</span> <span class="s2">&quot;kather100k-validation-sample.zip&quot;</span>
<span class="n">weights_path</span> <span class="o">=</span> <span class="n">global_save_dir</span> <span class="o">/</span> <span class="s2">&quot;resnet18-kather100k.pth&quot;</span>

<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Download has started. Please wait...&quot;</span><span class="p">)</span>

<span class="c1"># 전체 슬라이드 이미지(whole-slide image) 샘플을 다운로드 하고 압축을 해제하기</span>
<span class="n">download_data</span><span class="p">(</span>
    <span class="s2">&quot;https://tiatoolbox.dcs.warwick.ac.uk/sample_wsis/TCGA-3L-AA1B-01Z-00-DX1.8923A151-A690-40B7-9E5A-FCBEDFC2394F.svs&quot;</span><span class="p">,</span>
    <span class="n">wsi_path</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Kather 100K 데이터셋을 훈련하기 위해 사용된 검증 세트(validation set) 샘플을 다운로드하고 압축을 해제하기</span>
<span class="n">download_data</span><span class="p">(</span>
    <span class="s2">&quot;https://tiatoolbox.dcs.warwick.ac.uk/datasets/kather100k-validation-sample.zip&quot;</span><span class="p">,</span>
    <span class="n">patches_path</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">with</span> <span class="n">ZipFile</span><span class="p">(</span><span class="n">patches_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipfile</span><span class="p">:</span>
    <span class="n">zipfile</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">global_save_dir</span><span class="p">)</span>

<span class="c1"># ResNet18 아키텍처로 WSI(전체 슬라이드 이미지) 분류를 위해 사전 학습된 모델 가중치를 다운로드하기</span>
<span class="n">download_data</span><span class="p">(</span>
    <span class="s2">&quot;https://tiatoolbox.dcs.warwick.ac.uk/models/pc/resnet18-kather100k.pth&quot;</span><span class="p">,</span>
    <span class="n">weights_path</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Download is complete.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id6">
<h2>데이터 읽기<a class="headerlink" href="#id6" title="이 제목에 대한 퍼머링크">¶</a></h2>
<p>패치 목록과 해당되는 라벨 목록을 생성합니다.
예를 들어, <code class="docutils literal notranslate"><span class="pre">label_list</span></code> 의 첫 번째 라벨은
<code class="docutils literal notranslate"><span class="pre">patch_list</span></code> 의 첫 번째 이미지 패치의 클래스를 나타냅니다.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 패치 데이터를 읽고 패치 목록과 해당 라벨 목록을 생성</span>
<span class="n">dataset_path</span> <span class="o">=</span> <span class="n">global_save_dir</span> <span class="o">/</span> <span class="s2">&quot;kather100k-validation-sample&quot;</span>

<span class="c1"># 데이터셋 경로 설정</span>
<span class="n">image_ext</span> <span class="o">=</span> <span class="s2">&quot;.tif&quot;</span>  <span class="c1"># 각 이미지의 파일 확장자</span>

<span class="c1"># 라벨 ID와 클래스 이름 간의 매핑</span>
<span class="n">label_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;BACK&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="c1"># Background (empty glass region)  # 이 부분은 밑에서 자세히 설명</span>
    <span class="s2">&quot;NORM&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># Normal colon mucosa</span>
    <span class="s2">&quot;DEB&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>  <span class="c1"># Debris</span>
    <span class="s2">&quot;TUM&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>  <span class="c1"># Colorectal adenocarcinoma epithelium</span>
    <span class="s2">&quot;ADI&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>  <span class="c1"># Adipose</span>
    <span class="s2">&quot;MUC&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>  <span class="c1"># Mucus</span>
    <span class="s2">&quot;MUS&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>  <span class="c1"># Smooth muscle</span>
    <span class="s2">&quot;STR&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>  <span class="c1"># Cancer-associated stroma</span>
    <span class="s2">&quot;LYM&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>  <span class="c1"># Lymphocytes</span>
<span class="p">}</span>

<span class="n">class_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">label_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="n">class_labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">label_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="c1"># 패치 목록 생성 및 파일 이름에서 라벨 추출하기</span>
<span class="n">patch_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">label_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">label_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">dataset_class_path</span> <span class="o">=</span> <span class="n">dataset_path</span> <span class="o">/</span> <span class="n">class_name</span>
    <span class="n">patch_list_single_class</span> <span class="o">=</span> <span class="n">grab_files_from_dir</span><span class="p">(</span>
        <span class="n">dataset_class_path</span><span class="p">,</span>
        <span class="n">file_types</span><span class="o">=</span><span class="s2">&quot;*&quot;</span> <span class="o">+</span> <span class="n">image_ext</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">patch_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">patch_list_single_class</span><span class="p">)</span>
    <span class="n">label_list</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">label</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">patch_list_single_class</span><span class="p">))</span>

<span class="c1"># 데이터셋 통계 표기</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">class_names</span><span class="p">,</span> <span class="p">[</span><span class="n">label_list</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">class_labels</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Patch types&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Number of patches&quot;</span><span class="p">)</span>

<span class="c1"># 클래스별 예시 개수 집계</span>
<span class="k">for</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">label_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s2">&quot;Class ID: </span><span class="si">%d</span><span class="s2"> -- Class Name: </span><span class="si">%s</span><span class="s2"> -- Number of images: </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">label</span><span class="p">,</span>
        <span class="n">class_name</span><span class="p">,</span>
        <span class="n">label_list</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">label</span><span class="p">),</span>
    <span class="p">)</span>

<span class="c1"># 전체 데이터셋 통계</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Total number of patches: </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">patch_list</span><span class="p">)))</span>
</pre></div>
</div>
<img src="../_images/tiatoolbox_tutorial_001.png" srcset="../_images/tiatoolbox_tutorial_001.png" alt="tiatoolbox tutorial" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>|2023-11-14|13:15:59.299| [INFO] Class ID: 0 -- Class Name: BACK -- Number of images: 211
|2023-11-14|13:15:59.299| [INFO] Class ID: 1 -- Class Name: NORM -- Number of images: 176
|2023-11-14|13:15:59.299| [INFO] Class ID: 2 -- Class Name: DEB -- Number of images: 230
|2023-11-14|13:15:59.299| [INFO] Class ID: 3 -- Class Name: TUM -- Number of images: 286
|2023-11-14|13:15:59.299| [INFO] Class ID: 4 -- Class Name: ADI -- Number of images: 208
|2023-11-14|13:15:59.299| [INFO] Class ID: 5 -- Class Name: MUC -- Number of images: 178
|2023-11-14|13:15:59.299| [INFO] Class ID: 6 -- Class Name: MUS -- Number of images: 270
|2023-11-14|13:15:59.299| [INFO] Class ID: 7 -- Class Name: STR -- Number of images: 209
|2023-11-14|13:15:59.299| [INFO] Class ID: 8 -- Class Name: LYM -- Number of images: 232
|2023-11-14|13:15:59.299| [INFO] Total number of patches: 2000
</pre></div>
</div>
<p>이 패치 데이터셋에서 볼 수 있듯이,
0부터 8까지의 ID를 가진 9개의 클래스와 라벨이 있으며,
각 클래스는 해당 패치에서 주로 나타나는 조직 유형을 설명합니다:</p>
<ul class="simple">
<li><p>BACK ⟶ 배경(Background)(비어 있는 영역)</p></li>
<li><p>LYM ⟶ 림프구(Lymphocytes)</p></li>
<li><p>NORM ⟶ 정상 대장 점막(Normal colon mucosa)</p></li>
<li><p>DEB ⟶ 조직 파편(Debris)</p></li>
<li><p>MUS ⟶ 평활근(Smooth muscle)</p></li>
<li><p>STR ⟶ 암 관련 기질(Cancer-associated stroma)</p></li>
<li><p>ADI ⟶ 지방 조직(Adipose)</p></li>
<li><p>MUC ⟶ 점액(Mucus)</p></li>
<li><p>TUM ⟶ 대장선암 상(Colorectal adenocarcinoma epithelium)</p></li>
</ul>
</div>
<div class="section" id="id7">
<h2>이미지 패치 분류<a class="headerlink" href="#id7" title="이 제목에 대한 퍼머링크">¶</a></h2>
<p>먼저 <code class="docutils literal notranslate"><span class="pre">patch</span></code> 모드를 사용하여 디지털 슬라이드 내의
각 패치에 대한 예측을 구하는 방법을 시연한 후, <code class="docutils literal notranslate"><span class="pre">wsi</span></code> 모드를 사용하여
큰(large) 슬라이드에 대해 예측을 수행하는 방법을 보여줍니다.</p>
<div class="section" id="patchpredictor">
<h3><code class="docutils literal notranslate"><span class="pre">PatchPredictor</span></code> 모델 정의하기<a class="headerlink" href="#patchpredictor" title="이 제목에 대한 퍼머링크">¶</a></h3>
<p>PatchPredictor 클래스는 PyTorch로 작성된 CNN 기반 분류기를 실행합니다</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">모델</span></code> 은 <code class="docutils literal notranslate"><span class="pre">tiatoolbox.models.abc.ModelABC</span></code> <a href="#id8"><span class="problematic" id="id9">`</span></a>(문서)</dt><dd><p>&lt;<a class="reference external" href="https://tia-toolbox.readthedocs.io/en/latest/_autosummary/tiatoolbox.models.models_abc.ModelABC.html">https://tia-toolbox.readthedocs.io/en/latest/_autosummary/tiatoolbox.models.models_abc.ModelABC.html</a>&gt;`__
클래스 구조를 따르는 모든 PyTorch로 훈련된 모델을 사용할 수 있습니다.
이에 대한 자세한 내용은 <a class="reference external" href="https://github.com/TissueImageAnalytics/tiatoolbox/blob/develop/examples/07-advanced-modeling.ipynb">고급 모델 기술에 관한 예제 노트북(notebook)</a>.
을 참조하십시오. 커스텀 모델을 로드하려면,
<code class="docutils literal notranslate"><span class="pre">preproc_func(img)</span></code> 와 같은
전처리 함수를 작성해야 하며, 이 함수는 입력 tensor가
로드된 네트워크에 적합한 형식으로 되어 있는지 확인해줍니다.</p>
</dd>
</dl>
</li>
<li><p>또한, <code class="docutils literal notranslate"><span class="pre">사전</span> <span class="pre">학습된</span> <span class="pre">모델(pretrained_model)</span></code> 을 문자열 인수로
전달할 수 있습니다. 이는 예측을 수행할 CNN 모델을 지정하며, 해당 모델은
<a class="reference external" href="https://tia-toolbox.readthedocs.io/en/latest/usage.html?highlight=pretrained%20models#tiatoolbox.models.architecture.get_pretrained_model">여기</a>
나열된 모델 중 하나이어야 합니다.
명령어는 다음과 같습니다:
<code class="docutils literal notranslate"><span class="pre">predictor</span> <span class="pre">=</span> <span class="pre">PatchPredictor(pretrained_model='resnet18-kather100k',</span> <span class="pre">pretrained_weights=weights_path,</span> <span class="pre">batch_size=32)</span></code> .</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pretrained_weights</span></code> : <code class="docutils literal notranslate"><span class="pre">사전</span> <span class="pre">학습된</span> <span class="pre">모델(pretrained_model)</span></code> 을 사용할 때,
해당 모델의 사전 학습된 가중치도 기본적으로 다운로드 됩니다.
기본으로 제공되는 가중치를 덮어쓰고 자신만의 가중치를 사용하려면
<code class="docutils literal notranslate"><span class="pre">pretrained_weight</span></code> 인수를 통해 가중치를 지정할 수 있습니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">batch_size</span></code> : 모델에 한 번에 입력되는 이미지의 개수를 지정합니다. 이 값이 클수록
더 많은 (GPU)메모리 용량이 필요합니다.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># TIAToolbox에서 사전 학습된 PyTorch 모델 가져오기</span>
<span class="n">predictor</span> <span class="o">=</span> <span class="n">PatchPredictor</span><span class="p">(</span><span class="n">pretrained_model</span><span class="o">=</span><span class="s1">&#39;resnet18-kather100k&#39;</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>

<span class="c1"># 사용자는 아래 스크립트를 통해 원하는 PyTorch 모델 아키텍처를 불러올 수 있습니다.</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">vanilla</span><span class="o">.</span><span class="n">CNNModel</span><span class="p">(</span><span class="n">backbone</span><span class="o">=</span><span class="s2">&quot;resnet18&quot;</span><span class="p">,</span> <span class="n">num_classes</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span> <span class="c1"># torchvision.models.resnet18에서 모델 불러오기</span>
<span class="n">model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">weights_path</span><span class="p">,</span> <span class="n">map_location</span><span class="o">=</span><span class="s2">&quot;cpu&quot;</span><span class="p">),</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">preproc_func</span><span class="p">(</span><span class="n">img</span><span class="p">):</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">()(</span><span class="n">img</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">img</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">preproc_func</span> <span class="o">=</span> <span class="n">preproc_func</span>
<span class="n">predictor</span> <span class="o">=</span> <span class="n">PatchPredictor</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id10">
<h3>패치 라벨 예측하기<a class="headerlink" href="#id10" title="이 제목에 대한 퍼머링크">¶</a></h3>
<p>예측기(predictor) 객체를 생성한 후 <code class="docutils literal notranslate"><span class="pre">patch</span></code> 모드를 사용하여 <code class="docutils literal notranslate"><span class="pre">predict</span></code> 메소드를 호출합니다.
그런 다음, 분류 정확도와 오차 행렬(confusion matrix)을 계산합니다.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">suppress_console_output</span><span class="p">():</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">predictor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">imgs</span><span class="o">=</span><span class="n">patch_list</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;patch&quot;</span><span class="p">,</span> <span class="n">on_gpu</span><span class="o">=</span><span class="n">ON_GPU</span><span class="p">)</span>

<span class="n">acc</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">label_list</span><span class="p">,</span> <span class="n">output</span><span class="p">[</span><span class="s2">&quot;predictions&quot;</span><span class="p">])</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Classification accuracy: </span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">acc</span><span class="p">)</span>

<span class="c1"># 패치 분류 결과를 위한 오차 행렬(confusion_matrix) 생성 및 시각화</span>
<span class="n">conf</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">label_list</span><span class="p">,</span> <span class="n">output</span><span class="p">[</span><span class="s2">&quot;predictions&quot;</span><span class="p">],</span> <span class="n">normalize</span><span class="o">=</span><span class="s2">&quot;true&quot;</span><span class="p">)</span>
<span class="n">df_cm</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">class_names</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">class_names</span><span class="p">)</span>
<span class="n">df_cm</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>|2023-11-14|13:16:03.215| [INFO] Classification accuracy: 0.993000
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>BACK</th>
      <th>NORM</th>
      <th>DEB</th>
      <th>TUM</th>
      <th>ADI</th>
      <th>MUC</th>
      <th>MUS</th>
      <th>STR</th>
      <th>LYM</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>BACK</th>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.00000</td>
    </tr>
    <tr>
      <th>NORM</th>
      <td>0.000000</td>
      <td>0.988636</td>
      <td>0.000000</td>
      <td>0.011364</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.00000</td>
    </tr>
    <tr>
      <th>DEB</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.991304</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.008696</td>
      <td>0.00000</td>
    </tr>
    <tr>
      <th>TUM</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.996503</td>
      <td>0.000000</td>
      <td>0.003497</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.00000</td>
    </tr>
    <tr>
      <th>ADI</th>
      <td>0.004808</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.990385</td>
      <td>0.000000</td>
      <td>0.004808</td>
      <td>0.000000</td>
      <td>0.00000</td>
    </tr>
    <tr>
      <th>MUC</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.988764</td>
      <td>0.000000</td>
      <td>0.011236</td>
      <td>0.00000</td>
    </tr>
    <tr>
      <th>MUS</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.996296</td>
      <td>0.003704</td>
      <td>0.00000</td>
    </tr>
    <tr>
      <th>STR</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.004785</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.004785</td>
      <td>0.004785</td>
      <td>0.985646</td>
      <td>0.00000</td>
    </tr>
    <tr>
      <th>LYM</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.004310</td>
      <td>0.99569</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<br/>
<br/></div>
<div class="section" id="whole-slide">
<h3>전체 슬라이드(whole slide)에 대한 패치 라벨 예측<a class="headerlink" href="#whole-slide" title="이 제목에 대한 퍼머링크">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">IOPatchPredictorConfig</span></code> 클래스를 소개합니다. 이 클래스는 모델 예측 엔진을
위한 이미지 읽기 및 예측 결과 쓰기 구성 설정을 지정합니다.
이 설정은 분류기(classifier)에게 WSI 피라미드의 어느 레벨을 읽고,
데이터를 처리하며, 출력을 생성해야 하는지 알려주는 데
필수적입니다.</p>
<p><code class="docutils literal notranslate"><span class="pre">IOPatchPredictorConfig</span></code> 의 매개변수는 다음과 같이 정의됩니다.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">input_resolutions</span></code>: 입력의 해상도를 지정하는 딕셔너리 형태의 리스트로,
각 입력의 해상도를 설정합니다. 리스트의 요소는 <code class="docutils literal notranslate"><span class="pre">model.forward()</span></code> 의
순서와 같아야합니다. 만약 모델이 하나의 입력만 받는 경우,
하나의 딕셔너리로 <code class="docutils literal notranslate"><span class="pre">'units'</span></code> 와 <code class="docutils literal notranslate"><span class="pre">'resolution'</span></code>
을 지정하면 됩니다. TIAToolbox는 하나 이상의 입력을 받는 모델을
지원하므로, 여러 입력을 사용하는 경우에도 문제없이 사용할 수 있습니다.
유닛(units)과 해상도(resolution)에 대한 자세한 내용은 <a class="reference external" href="https://tia-toolbox.readthedocs.io/en/latest/_autosummary/tiatoolbox.wsicore.wsireader.WSIReader.html#tiatoolbox.wsicore.wsireader.WSIReader.read_rect">TIAToolbox
문서</a> 를 참고하십시오.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">patch_input_shape</span></code>: 가장 큰 입력의 크기를 (높이, 너비) 형식으로
지정합니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stride_shape</span></code>: 연속된 두 패치 사이의 간격(단계) 크기를 지정하며,
패치 추출 과정에서 사용됩니다. 사용자가
<code class="docutils literal notranslate"><span class="pre">stride_shape</span></code> 를 <code class="docutils literal notranslate"><span class="pre">patch_input_shape</span></code> 와 동일하게 설정하면, 패치들이
중첩없이 추출되고, 처리됩니다.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">wsi_ioconfig</span> <span class="o">=</span> <span class="n">IOPatchPredictorConfig</span><span class="p">(</span>
    <span class="n">input_resolutions</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;mpp&quot;</span><span class="p">,</span> <span class="s2">&quot;resolution&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">}],</span>
    <span class="n">patch_input_shape</span><span class="o">=</span><span class="p">[</span><span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">],</span>
    <span class="n">stride_shape</span><span class="o">=</span><span class="p">[</span><span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">predict</span></code> 메소드는 입력 패치에 CNN을 적용하여 결과를 얻습니다.
다음은 해당 메소드의 인수와 설명입니다:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">mode</span></code>: 처리할 입력의 유형을 지정합니다. 응용 프로그램에 따라 <code class="docutils literal notranslate"><span class="pre">patch</span></code>,
<code class="docutils literal notranslate"><span class="pre">tile</span></code> 또는 <code class="docutils literal notranslate"><span class="pre">wsi</span></code> 중에서 선택합니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">imgs</span></code>: 입력 파일들의 경로 리스트로, 입력 타일(input tiles) 또는
WSIs 경로의 목록이어야 합니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">return_probabilities</span></code>: 입력 패치의 예측된 라벨과 함께 클래스별
확률을 얻으려면 <strong>True</strong> 로 설정합니다. <code class="docutils literal notranslate"><span class="pre">tile</span></code> 또는 <code class="docutils literal notranslate"><span class="pre">wsi</span></code> 모드에서
예측 결과를 병합하여 예측 맵을 생성하려면 <code class="docutils literal notranslate"><span class="pre">return_probabilities=True</span></code>
로 설정할 수 있습니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ioconfig</span></code>: <code class="docutils literal notranslate"><span class="pre">IOPatchPredictorConfig</span></code> 클래스를 사용하여 IO
구성 정보를 설정합니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">resolution</span></code> 과 <code class="docutils literal notranslate"><span class="pre">unit</span></code> (아래에 표시되지 않음): 추출할 패치의 WSI 레벨
또는 마이크론당 픽셀 해상도를 지정합니다.
이는 <code class="docutils literal notranslate"><span class="pre">ioconfig</span></code> 대신 사용할 수 있습니다.
여기서 WSI 레벨은 <code class="docutils literal notranslate"><span class="pre">'baseline'</span></code> 으로 지정하며,
이는 일반적으로 레벨 0에
이 경우 이미지는 하나의 레벨만 가지고 있습니다.
더 자세한 내용은 <a class="reference external" href="https://tia-toolbox.readthedocs.io/en/latest/usage.html?highlight=WSIReader.read_rect#tiatoolbox.wsicore.wsireader.WSIReader.read_rect">문서</a> 에서
확인할 수 있습니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">masks</span></code>: <code class="docutils literal notranslate"><span class="pre">imgs</span></code> 리스트에 있는 WSI의 마스크 경로 리스트입니다.
이 마스크는 원본 WSI에서 패치를 추출하고자 하는 영역을
지정합니다. 특정 WSI의 마스크가 <code class="docutils literal notranslate"><span class="pre">None</span></code> 으로 지정되면,
해당 WSI의 모든 패치(배경 영역 포함)에 대한 라벨이
예측됩니다. 이는 불필요한
계산을 유발할 수 있습니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">merge_predictions</span></code>: 패치 분류 결과를 2D 맵으로
생성해야하는 경우 <code class="docutils literal notranslate"><span class="pre">True</span></code> 로 설정할 수 있습니다.
그러나 큰 WSI의 경우 많은 메모리가 필요할 수 있습니다.
대안적인 해결책으로는 <code class="docutils literal notranslate"><span class="pre">merge_predictions=False</span></code> 로(기본값) 설정하여,
추후에 <code class="docutils literal notranslate"><span class="pre">merge_predictions</span></code> 함수를 사용해 2D 예측 맵을 생성하는
방법을 사용할 수 있습니다.</p></li>
</ul>
<p>큰 WSI를 사용하고 있기 때문에 패치 추출 및 예측 과정에 시간이 다소 걸릴 수 있습니다.
(만약 Cuda가 활성화된 GPU를 사용할 수 있다면
<code class="docutils literal notranslate"><span class="pre">ON_GPU=True</span></code> 로 설정하여 PyTorch와 Cuda를 활용하는 것이 좋습니다).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">suppress_console_output</span><span class="p">():</span>
    <span class="n">wsi_output</span> <span class="o">=</span> <span class="n">predictor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
        <span class="n">imgs</span><span class="o">=</span><span class="p">[</span><span class="n">wsi_path</span><span class="p">],</span>
        <span class="n">masks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;wsi&quot;</span><span class="p">,</span>
        <span class="n">merge_predictions</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">ioconfig</span><span class="o">=</span><span class="n">wsi_ioconfig</span><span class="p">,</span>
        <span class="n">return_probabilities</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">save_dir</span><span class="o">=</span><span class="n">global_save_dir</span> <span class="o">/</span> <span class="s2">&quot;wsi_predictions&quot;</span><span class="p">,</span>
        <span class="n">on_gpu</span><span class="o">=</span><span class="n">ON_GPU</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">wsi_output</span></code> 을 시각화하여 예측 모델이 전체 슬라이드 이미지(WSI)에서
어떻게 작동하는지 확인할 수 있습니다. 먼저 패치 예측 결과를 병합한 후,
이를 원본 이미지 위에 오버레이로 시각화해야 합니다. 이전과 마찬가지로
<code class="docutils literal notranslate"><span class="pre">merge_predictions</span></code> 메소드를 사용하여 패치 예측을 병합합니다.
이때, 1.25x 만큼 확대된 예측 맵을 생성하기 위해
<code class="docutils literal notranslate"><span class="pre">resolution=1.25,</span> <span class="pre">units='power'</span></code> 로 매개변수를 설정합니다.
만약 더 높은/낮은 해상도 (더 큰/작은) 예측 맵을 원한다면,
이 매개변수를 적절히 변경해야 합니다.
예측이 병합되면 <code class="docutils literal notranslate"><span class="pre">overlay_patch_prediction</span></code> 함수를 사용하여
예측 맵을 WSI 썸네일에 오버레이합니다. 이때 사용된 해상도는
예측 병합에 사용된 해상도와
일치해야합니다.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">overview_resolution</span> <span class="o">=</span> <span class="p">(</span>
    <span class="mi">4</span>  <span class="c1"># 패치 예측을 병합하고 시각화하는 해상도 설정</span>
<span class="p">)</span>
<span class="c1"># &#39;해상도&#39; 매개변수의 단위 설정. &quot;power&quot;, &quot;level&quot;, &quot;mpp&quot;, 또는 &quot;baseline&quot; 중에서 선택 가능</span>
<span class="n">overview_unit</span> <span class="o">=</span> <span class="s2">&quot;mpp&quot;</span>
<span class="n">wsi</span> <span class="o">=</span> <span class="n">WSIReader</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">wsi_path</span><span class="p">)</span>
<span class="n">wsi_overview</span> <span class="o">=</span> <span class="n">wsi</span><span class="o">.</span><span class="n">slide_thumbnail</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="n">overview_resolution</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">overview_unit</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(),</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">wsi_overview</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/tiatoolbox_tutorial_002.png" srcset="../_images/tiatoolbox_tutorial_002.png" alt="tiatoolbox tutorial" class = "sphx-glr-single-img"/><p>예측 맵을 이 이미지에 오버레이한 결과는 다음과 같습니다:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 전체 슬라이드 이미지(Whole slide image)의 패치 레벨 예측 시각화</span>
<span class="c1"># 먼저 라벨 색상의 매핑 설정</span>
<span class="n">label_color_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">label_color_dict</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;empty&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;Set1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">colors</span>
<span class="k">for</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">label_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">label_color_dict</span><span class="p">[</span><span class="n">label</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">class_name</span><span class="p">,</span> <span class="mi">255</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">label</span><span class="p">]))</span>

<span class="n">pred_map</span> <span class="o">=</span> <span class="n">predictor</span><span class="o">.</span><span class="n">merge_predictions</span><span class="p">(</span>
    <span class="n">wsi_path</span><span class="p">,</span>
    <span class="n">wsi_output</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">resolution</span><span class="o">=</span><span class="n">overview_resolution</span><span class="p">,</span>
    <span class="n">units</span><span class="o">=</span><span class="n">overview_unit</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">overlay</span> <span class="o">=</span> <span class="n">overlay_prediction_mask</span><span class="p">(</span>
    <span class="n">wsi_overview</span><span class="p">,</span>
    <span class="n">pred_map</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">label_info</span><span class="o">=</span><span class="n">label_color_dict</span><span class="p">,</span>
    <span class="n">return_ax</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../_images/tiatoolbox_tutorial_003.png" srcset="../_images/tiatoolbox_tutorial_003.png" alt="tiatoolbox tutorial" class = "sphx-glr-single-img"/></div>
</div>
<div class="section" id="id11">
<h2>병리학에 특화된 모델을 사용한 특징 추출<a class="headerlink" href="#id11" title="이 제목에 대한 퍼머링크">¶</a></h2>
<p>이 부분에서는 TIAToolbox 외부에 존재하는 사전 학습된
PyTorch 모델에서 특징을 추출하는 방법을 TIAToolbox에서
제공하는 WSI 추론 엔진을 사용하여 보여줍니다. 이를 설명하기 위해,
HistoEncoder라는 병리학적 이미지에 특화된 모델을 사용할 것입니다.
HistoEncoder는 조직학 이미지에서 특징을 추출하도록 자가 지도 학습 방식(self-supervised)
으로 학습되었습니다. 이 모델은 다음에서 사용할 수 있습니다:</p>
<p>‘HistoEncoder: 디지털 병리학을 위한 기본 모델’
(<a class="reference external" href="https://github.com/jopo666/HistoEncoder">https://github.com/jopo666/HistoEncoder</a>) 헬싱키 대학교
Pohjonen, Joona 팀.</p>
<p>특징 맵의 umap 차원 축소를 3D(RGB)로 시각화하여,
위에서 언급한 여러 조직 유형 간의 차이를 특징들이
어떻게 포착하는지 보여줄 것입니다.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 추가 module 가져오기</span>
<span class="kn">import</span> <span class="nn">histoencoder.functional</span> <span class="k">as</span> <span class="nn">F</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>

<span class="kn">from</span> <span class="nn">tiatoolbox.models.engine.semantic_segmentor</span> <span class="kn">import</span> <span class="n">DeepFeatureExtractor</span><span class="p">,</span> <span class="n">IOSegmentorConfig</span>
<span class="kn">from</span> <span class="nn">tiatoolbox.models.models_abc</span> <span class="kn">import</span> <span class="n">ModelABC</span>
<span class="kn">import</span> <span class="nn">umap</span>
</pre></div>
</div>
<p>TIAToolbox는 PyTorch의 <a class="reference external" href="https://pytorch.org/docs/stable/generated/torch.nn.Module.html">nn.Module</a>
을 상속하는 ModelABC 클래스를 정의하며,
이는 TIAToolbox의 추론 엔진에서 사용될 모델의
구조를 규정합니다. 하지만 histoencoder 모델은 이 구조를
따르지 않기 때문에, TIAToolbox 엔진이 기대하는 출력과
메소드를 제공하는 클래스로 HistoEncoder를 래핑(wrap)해야 합니다.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">HistoEncWrapper</span><span class="p">(</span><span class="n">ModelABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;tiatoolbox의 ModelABC 인터페이스에 맞춘 HistoEncW모델의 레퍼 생성&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">HistoEncWrapper</span><span class="p">,</span> <span class="n">encoder</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feat_extract</span> <span class="o">=</span> <span class="n">encoder</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">HistoEncWrapper</span><span class="p">,</span> <span class="n">imgs</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;입력 데이터를 모델을 통해 전달</span>

<span class="sd">        Args:</span>
<span class="sd">            imgs (torch.Tensor):</span>
<span class="sd">                Model input.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">extract_features</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feat_extract</span><span class="p">,</span> <span class="n">imgs</span><span class="p">,</span> <span class="n">num_blocks</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">avg_pool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">infer_batch</span><span class="p">(</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span>
        <span class="n">batch_data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">on_gpu</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;입력 배치에 대한 추론 실행</span>

<span class="sd">        순방향 연산과 입출력 집계를 위한 로직이 포함되어 있습니다.</span>

<span class="sd">        Args:</span>
<span class="sd">            model (nn.Module):</span>
<span class="sd">                정의된 PyTorch 모델.</span>
<span class="sd">            batch_data (torch.Tensor):</span>
<span class="sd">                `torch.utils.data.DataLoader`에</span>
<span class="sd">                의해 생성된 데이터의 배치(batch).</span>
<span class="sd">            on_gpu (bool):</span>
<span class="sd">                추론 연산을 GPU에서 할 것인지.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">img_patches_device</span> <span class="o">=</span> <span class="n">batch_data</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;cuda&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">on_gpu</span> <span class="k">else</span> <span class="n">batch_data</span>
        <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
        <span class="c1"># 기울기를 계산하지 않음(훈련이 아님)</span>
        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">inference_mode</span><span class="p">():</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">img_patches_device</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">output</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()]</span>
</pre></div>
</div>
<p>이제 래퍼(wrapper)를 만들었으니, 특징 추출 모델을
생성하고 <a class="reference external" href="https://tia-toolbox.readthedocs.io/en/v1.4.1/_autosummary/tiatoolbox.models.engine.semantic_segmentor.DeepFeatureExtractor.html">DeepFeatureExtractor</a>
를 인스턴스화 하여 이 모델을
WSI에 사용할 수 있게 합니다. 이전에 사용했던 동일한 WSI를 사용하지만,
이번에는 각 패치에 대한 라벨을 예측하는 대신
HistoEncoder 모델을 사용하여, WSI의 패치에서
특징을 추출할 것입니다.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 모델 만들기</span>
<span class="n">encoder</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">create_encoder</span><span class="p">(</span><span class="s2">&quot;prostate_medium&quot;</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">HistoEncWrapper</span><span class="p">(</span><span class="n">encoder</span><span class="p">)</span>

<span class="c1"># 전처리 함수 설정</span>
<span class="n">norm</span><span class="o">=</span><span class="n">transforms</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="p">[</span><span class="mf">0.662</span><span class="p">,</span> <span class="mf">0.446</span><span class="p">,</span> <span class="mf">0.605</span><span class="p">],</span><span class="n">std</span><span class="o">=</span><span class="p">[</span><span class="mf">0.169</span><span class="p">,</span> <span class="mf">0.190</span><span class="p">,</span> <span class="mf">0.155</span><span class="p">])</span>
<span class="n">trans</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">(),</span>
    <span class="n">norm</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">model</span><span class="o">.</span><span class="n">preproc_func</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Compose</span><span class="p">(</span><span class="n">trans</span><span class="p">)</span>

<span class="n">wsi_ioconfig</span> <span class="o">=</span> <span class="n">IOSegmentorConfig</span><span class="p">(</span>
    <span class="n">input_resolutions</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;mpp&quot;</span><span class="p">,</span> <span class="s2">&quot;resolution&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">}],</span>
    <span class="n">patch_input_shape</span><span class="o">=</span><span class="p">[</span><span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">],</span>
    <span class="n">output_resolutions</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;mpp&quot;</span><span class="p">,</span> <span class="s2">&quot;resolution&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">}],</span>
    <span class="n">patch_output_shape</span><span class="o">=</span><span class="p">[</span><span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">],</span>
    <span class="n">stride_shape</span><span class="o">=</span><span class="p">[</span><span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">DeepFeatureExtractor</span></code> 를 생성할 때
<code class="docutils literal notranslate"><span class="pre">auto_generate_mask=True</span></code> 인수를 전달할 것입니다. 이는 otsu 임계값
알고리즘을 사용하여 자동으로 조직 영역의 마스크를 생성하여, 추출기가
조직이 포함된 패치에만 처리하도록 합니다.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 특징 추출기 생성 및 WSI에서 실행하기</span>
<span class="n">extractor</span> <span class="o">=</span> <span class="n">DeepFeatureExtractor</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">auto_generate_mask</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">num_loader_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">num_postproc_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="k">with</span> <span class="n">suppress_console_output</span><span class="p">():</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">extractor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">imgs</span><span class="o">=</span><span class="p">[</span><span class="n">wsi_path</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;wsi&quot;</span><span class="p">,</span> <span class="n">ioconfig</span><span class="o">=</span><span class="n">wsi_ioconfig</span><span class="p">,</span> <span class="n">save_dir</span><span class="o">=</span><span class="n">global_save_dir</span> <span class="o">/</span> <span class="s2">&quot;wsi_features&quot;</span><span class="p">,)</span>
</pre></div>
</div>
<p>이러한 특징들은 다운스트림 모델을 훈련하는 데 사용할 수 있지만, 여기서는
특징이 무엇을 나타내는지 직관적으로 이해하기 위해 UMAP 차원 축소를 사용하여
특징을 RGB 공간에서 시각화할 것입니다. 유사한 색상으로 라벨링된 포인트들은
비슷한 특징을 가지고 있어야 하므로, UMAP 축소 결과를
WSI 썸네일에 오버레이하여 특징들이 서로 다른 조직 영역으로
자연스럽게 분리되는지 확인할 수 있습니다. 이후,
위에서 생성한 패치 수준의 예측 맵과 함께 이를 시각화하여,
특징과 패치 수준 예측 간의 차이를 비교해보겠습니다.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 먼저, UMAP 축소 계산을 위한 함수 정의</span>
<span class="k">def</span> <span class="nf">umap_reducer</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">nns</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;입력 데이터의 UMAP 축소&quot;&quot;&quot;</span>
    <span class="n">reducer</span> <span class="o">=</span> <span class="n">umap</span><span class="o">.</span><span class="n">UMAP</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="n">nns</span><span class="p">,</span> <span class="n">n_components</span><span class="o">=</span><span class="n">dims</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;manhattan&quot;</span><span class="p">,</span> <span class="n">spread</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">reduced</span> <span class="o">=</span> <span class="n">reducer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">reduced</span> <span class="o">-=</span> <span class="n">reduced</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">reduced</span> <span class="o">/=</span> <span class="n">reduced</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">reduced</span>

<span class="c1"># 특징 추출기에서 출력된 특징 불러오기</span>
<span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">global_save_dir</span> <span class="o">/</span> <span class="s2">&quot;wsi_features&quot;</span> <span class="o">/</span> <span class="s2">&quot;0.position.npy&quot;</span><span class="p">)</span>
<span class="n">feats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">global_save_dir</span> <span class="o">/</span> <span class="s2">&quot;wsi_features&quot;</span> <span class="o">/</span> <span class="s2">&quot;0.features.0.npy&quot;</span><span class="p">)</span>
<span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">/</span> <span class="mi">8</span> <span class="c1"># 0.5mpp에서 특징을 추출하고, 4mpp에서 썸네일에 오버레이하기</span>

<span class="c1"># 특징을 3차원(RGB) 공간으로 축소하기</span>
<span class="n">reduced</span> <span class="o">=</span> <span class="n">umap_reducer</span><span class="p">(</span><span class="n">feats</span><span class="p">)</span>

<span class="c1"># 분류기의 예측 맵을 다시 그리기</span>
<span class="n">overlay</span> <span class="o">=</span> <span class="n">overlay_prediction_mask</span><span class="p">(</span>
    <span class="n">wsi_overview</span><span class="p">,</span>
    <span class="n">pred_map</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">label_info</span><span class="o">=</span><span class="n">label_color_dict</span><span class="p">,</span>
    <span class="n">return_ax</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># 특징 맵 축소를 시각화하기</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">wsi_overview</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">pos</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">reduced</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;UMAP reduction of HistoEnc features&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<ul class="sphx-glr-horizontal">
<li><img src="../_images/tiatoolbox_tutorial_004.png" srcset="../_images/tiatoolbox_tutorial_004.png" alt="tiatoolbox tutorial" class = "sphx-glr-multi-img"/></li>
<li><img src="../_images/tiatoolbox_tutorial_005.png" srcset="../_images/tiatoolbox_tutorial_005.png" alt="UMAP reduction of HistoEnc features" class = "sphx-glr-multi-img"/></li>
</ul>
<p>패치 수준 예측기(patch-level predictor)에서 생성된
예측 맵과 자가 지도 학습(self-supervised) 인코더를 통해 특징을
추출한 특징 맵이 WSI에서 조직 유형에 대한 유사한 정보를 포착하고
있음을 확인할 수 있습니다. 이는 모델이 예상대로 작동하고 있음을 확인할
수 있는 좋은 검증 방법입니다. 또한, HistoEncoder 모델이 추출한
특징들이 조직 유형 간의 차이를 잘 포착하고 있으며, 따라서 이 특징들이
조직학적으로 중요한 정보를 인코딩하고 있음을 보여줍니다.</p>
</div>
<div class="section" id="id12">
<h2>앞으로 해야할 것<a class="headerlink" href="#id12" title="이 제목에 대한 퍼머링크">¶</a></h2>
<p>이 노트북에서는 <code class="docutils literal notranslate"><span class="pre">PatchPredictor</span></code> 와
<code class="docutils literal notranslate"><span class="pre">DeepFeatureExtractor</span></code> 클래스의 <code class="docutils literal notranslate"><span class="pre">predict</span></code> 메소드를 사용하여
큰 타일(tiles)과 WSI의 패치에 대해 라벨을 예측하거나 특징을 추출하는 방법을 보여줍니다.
또한, 패치 예측 결과를 병합하고 입력 이미지/WSI에 예측 맵을
오버레이로 시각화하는 <code class="docutils literal notranslate"><span class="pre">merge_predictions</span></code> 와 <code class="docutils literal notranslate"><span class="pre">overlay_prediction_mask</span></code>
보조 함수도 소개합니다.</p>
<p>모든 과정은 TIAToolbox 내에서 이루어지며,
예제 코드를 따라 쉽게 구성할 수 있습니다.
입력값과 옵션을 올바르게 설정하는 것을 꼭 확인하세요.
또한 predict 함수의 매개변수를 변경했을 때
예측 결과에 미치는 영향을 탐구하는 것도 권장합니다.
TIAToolbox 프레임워크에서 제공하는 커뮤니티의 모델
또는 사용자 정의 사전 학습된 모델을 사용하여, TIAToolbox 모델 클래스에
정의되지 않은 구조의 모델이라도 대형 WSI에 대해 추론을 수행하는 방법을 시연했습니다.</p>
<p>다음 자료를 통해 더 많은 내용을 배울 수 있습니다:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://tia-toolbox.readthedocs.io/en/latest/_notebooks/jnb/07-advanced-modeling.html">PyTorch와 TIAToolbox를 통해 숙련된 모델
다루기</a></p></li>
<li><p><a class="reference external" href="https://tia-toolbox.readthedocs.io/en/latest/_notebooks/jnb/full-pipelines/slide-graph.html">커스텀 PyTorch 그래프 신경망을 사용하여 WSI(전체 슬라이드 이미지)에 대한 슬라이드 그래프
생성하기</a></p></li>
</ul>
</div>
</div>


             </article>
             
            </div>
            <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../beginner/audio_io_tutorial.html" class="btn btn-neutral float-right" title="Audio I/O" accesskey="n" rel="next">Next <img src="../_static/images/chevron-right-orange.svg" class="next-page"></a>
      
      
        <a href="../beginner/vt_tutorial.html" class="btn btn-neutral" title="배포를 위해 비전 트랜스포머(Vision Transformer) 모델 최적화하기" accesskey="p" rel="prev"><img src="../_static/images/chevron-right-orange.svg" class="previous-page"> Previous</a>
      
    </div>
  

  
    <hr class="community-hr hr-top" />
    <div class="community-container">
      <div class="community-prompt">더 궁금하시거나 개선할 내용이 있으신가요? 커뮤니티에 참여해보세요!</div>
      <div class="community-link"><a href="https://discuss.pytorch.kr/" aria-label="PyTorchKoreaCommunity">한국어 커뮤니티 바로가기</a></div>
    </div>
    <hr class="community-hr hr-bottom"/>

    <hr class="rating-hr hr-top" />
    <div class="rating-container">
      <div class="rating-prompt">이 튜토리얼이 어떠셨나요? 평가해주시면 이후 개선에 참고하겠습니다! :)</div>
      <div class="stars-outer">
        <i class="far fa-star" title="1 Star" data-behavior="tutorial-rating" data-count="1"></i>
        <i class="far fa-star" title="2 Stars" data-behavior="tutorial-rating" data-count="2"></i>
        <i class="far fa-star" title="3 Stars" data-behavior="tutorial-rating" data-count="3"></i>
        <i class="far fa-star" title="4 Stars" data-behavior="tutorial-rating" data-count="4"></i>
        <i class="far fa-star" title="5 Stars" data-behavior="tutorial-rating" data-count="5"></i>
      </div>
    </div>
    <hr class="rating-hr hr-bottom"/>
  

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018-2024, PyTorch &amp; 파이토치 한국 사용자 모임(PyTorch Korea User Group).

    </p>
  </div>
    
      <div>
        Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
      </div>
     

</footer>

          </div>
<script>
if((window.location.href.indexOf("/prototype/")!= -1) && (window.location.href.indexOf("/prototype/prototype_index")< 1))
  {
    var div = '<div class="admonition note"><p class="admonition-title">Note</p><p><i class="fa fa-flask" aria-hidden="true">&nbsp</i> 이 튜토리얼은 프로토타입(prototype) 기능들에 대해서 설명하고 있습니다. 프로토타입 기능은 일반적으로 피드백 및 테스트용으로, 런타임 플래그 없이는 PyPI나 Conda로 배포되는 바이너리에서는 사용할 수 없습니다.</p></div>'
    document.getElementById("pytorch-article").insertAdjacentHTML('afterBegin', div)
  }
</script>
        </div>

        <div class="pytorch-content-right" id="pytorch-content-right">
          <div class="pytorch-right-menu" id="pytorch-right-menu">
            <div class="pytorch-side-scroll" id="pytorch-side-scroll-right">
              <ul>
<li><a class="reference internal" href="#">Pytorch와 TIAToolbox를 사용한 전체 슬라이드 이미지(Whole Slide Image) 분류</a><ul>
<li><a class="reference internal" href="#id2">개요</a></li>
<li><a class="reference internal" href="#id3">환경설정</a><ul>
<li><a class="reference internal" href="#id4">관련 라이브러리 불러오기</a></li>
<li><a class="reference internal" href="#clean-up">실행 전 정리(clean-up)</a></li>
<li><a class="reference internal" href="#id5">데이터 다운로드</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id6">데이터 읽기</a></li>
<li><a class="reference internal" href="#id7">이미지 패치 분류</a><ul>
<li><a class="reference internal" href="#patchpredictor"><code class="docutils literal notranslate"><span class="pre">PatchPredictor</span></code> 모델 정의하기</a></li>
<li><a class="reference internal" href="#id10">패치 라벨 예측하기</a></li>
<li><a class="reference internal" href="#whole-slide">전체 슬라이드(whole slide)에 대한 패치 라벨 예측</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id11">병리학에 특화된 모델을 사용한 특징 추출</a></li>
<li><a class="reference internal" href="#id12">앞으로 해야할 것</a></li>
</ul>
</li>
</ul>

            </div>
          </div>
        </div>
      </section>
    </div>

  


  
  
     
       <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
         <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
         <script src="../_static/jquery.js"></script>
         <script src="../_static/underscore.js"></script>
         <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
         <script src="../_static/doctools.js"></script>
         <script src="../_static/clipboard.min.js"></script>
         <script src="../_static/copybutton.js"></script>
         <script src="../_static/translations.js"></script>
         <script src="../_static/katex.min.js"></script>
         <script src="../_static/auto-render.min.js"></script>
         <script src="../_static/katex_autorenderer.js"></script>
         <script src="../_static/design-tabs.js"></script>
     
  

  <script type="text/javascript" src="../_static/js/vendor/popper.min.js"></script>
  <script type="text/javascript" src="../_static/js/vendor/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 
<script>
//add microsoft link
if(window.location.href.indexOf("/beginner/basics/")!= -1)
{
  var url="https://docs.microsoft.com/learn/paths/pytorch-fundamentals/?wt.mc_id=aiml-7486-cxa";
  switch(window.location.pathname.split("/").pop().replace('.html',''))
  {
    case"quickstart_tutorial":
      url="https://docs.microsoft.com/learn/modules/intro-machine-learning-pytorch/9-quickstart?WT.mc_id=aiml-7486-cxa";
      break;
    case"tensorqs_tutorial":
      url="https://docs.microsoft.com/learn/modules/intro-machine-learning-pytorch/2-tensors?WT.mc_id=aiml-7486-cxa";
      break;
    case"data_tutorial":
      url="https://docs.microsoft.com/learn/modules/intro-machine-learning-pytorch/3-data?WT.mc_id=aiml-7486-cxa";
      break;
    case"transforms_tutorial":
      url="https://docs.microsoft.com/learn/modules/intro-machine-learning-pytorch/4-transforms?WT.mc_id=aiml-7486-cxa";
      break;
    case"buildmodel_tutorial":
      url="https://docs.microsoft.com/learn/modules/intro-machine-learning-pytorch/5-model?WT.mc_id=aiml-7486-cxa";
      break;
    case"autogradqs_tutorial":
      url="https://docs.microsoft.com/learn/modules/intro-machine-learning-pytorch/6-autograd?WT.mc_id=aiml-7486-cxa";
      break;
    case"optimization_tutorial":
      url="https://docs.microsoft.com/learn/modules/intro-machine-learning-pytorch/7-optimization?WT.mc_id=aiml-7486-cxa";
      break;
    case"saveloadrun_tutorial":
      url="https://docs.microsoft.com/learn/modules/intro-machine-learning-pytorch/8-inference?WT.mc_id=aiml-7486-cxa";
    }

    $(".pytorch-call-to-action-links").children().first().before("<a href="+url+' data-behavior="call-to-action-event" data-response="Run in Microsoft Learn" target="_blank"><div id="microsoft-learn-link" style="padding-bottom: 0.625rem;border-bottom: 1px solid #f3f4f7;padding-right: 2.5rem;display: -webkit-box;  display: -ms-flexbox; display: flex; -webkit-box-align: center;-ms-flex-align: center;align-items: center;"><img class="call-to-action-img" src="../../_static/images/microsoft-logo.svg"/><div class="call-to-action-desktop-view">Run in Microsoft Learn</div><div class="call-to-action-mobile-view">Learn</div></div></a>')
  }
</script>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-LZRD6GXDLF"></script>
<script data-cfasync="false">
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-LZRD6GXDLF');   // GA4
  gtag('config', 'UA-71919972-3');  // UA
</script>


<script data-cfasync="false">
  $("[data-behavior='call-to-action-event']").on('click', function(){
    ga('send', {
      hitType: 'event',
      eventCategory: $(this).attr("data-response"),
      eventAction: 'click',
      eventLabel: window.location.href
    });

    gtag('event', 'click', {
      'event_category': $(this).attr("data-response"),
      'event_label': $("h1").first().text(),
      'tutorial_link': window.location.href
    });
   });

   $("[data-behavior='tutorial-rating']").on('click', function(){
    gtag('event', 'click', {
      'event_category': 'Tutorial Rating',
      'event_label': $("h1").first().text(),
      'value': $(this).attr("data-count"),
      'customEvent:Rating': $(this).attr("data-count") // send to GA custom dimension customEvent:Rating.
    });
   });

   if (location.pathname == "/") {
     $(".rating-container").hide();
     $(".hr-bottom").hide();
   }
</script>

<script type="text/javascript">
  var collapsedSections = ['파이토치(PyTorch) 레시피', '파이토치(PyTorch) 배우기', 'Introduction to PyTorch on YouTube', '이미지/비디오', '오디오', '텍스트', '백엔드', '강화학습', 'PyTorch 모델을 프로덕션 환경에 배포하기', 'PyTorch 프로파일링', 'Code Transforms with FX', '프론트엔드 API', 'PyTorch 확장하기', '모델 최적화', '병렬 및 분산 학습', 'Edge with ExecuTorch', '추천 시스템', 'Multimodality'];
</script>



  <!-- Begin Footer -->

  <div class="container-fluid docs-tutorials-resources" id="docs-tutorials-resources">
    <div class="container">
      <div class="row">
        <div class="col-md-4 text-center">
          <h2>PyTorchKorea @ GitHub</h2>
          <p>파이토치 한국 사용자 모임을 GitHub에서 만나보세요.</p>
          <a class="with-right-arrow" href="https://github.com/PyTorchKorea" target="_blank">GitHub로 이동</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>한국어 튜토리얼</h2>
          <p>한국어로 번역 중인 PyTorch 튜토리얼입니다.</p>
          <a class="with-right-arrow" href="https://tutorials.pytorch.kr/">튜토리얼로 이동</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>커뮤니티</h2>
          <p>다른 사용자들과 의견을 나누고, 도와주세요!</p>
          <a class="with-right-arrow" href="https://discuss.pytorch.kr/">커뮤니티로 이동</a>
        </div>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="container footer-container">
      <div class="footer-logo-wrapper">
        <a href="https://pytorch.kr/" class="footer-logo"></a>
      </div>

      <div class="footer-links-wrapper">
        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.kr/">파이토치 한국 사용자 모임</a></li>
            <li><a href="https://pytorch.kr//about">사용자 모임 소개</a></li>
            <li><a href="https://pytorch.kr//about/contributors">기여해주신 분들</a></li>
            <li><a href="https://pytorch.kr//resources">리소스</a></li>
            <li><a href="https://pytorch.kr//coc">행동 강령</a></li>
          </ul>
        </div>
      </div>
      <div class="trademark-disclaimer">
        <ul>
          <li>이 사이트는 독립적인 파이토치 사용자 커뮤니티로, 최신 버전이 아니거나 잘못된 내용이 포함되어 있을 수 있습니다. This site is an independent user community and may be out of date or contain incorrect information.</li>
          <li><a href="https://pytorch.kr/coc">행동 강령</a>을 읽고 지켜주세요. PyTorch 공식 로고 사용 정책은 <a href="https://www.linuxfoundation.org/policies/">Linux Foundation의 정책</a>을 따릅니다. Please read and follow <a href="https://pytorch.kr/coc">our code of conduct</a>. All PyTorch trademark policy applicable to <a href="https://www.linuxfoundation.org/policies/">Linux Foundation's policies</a>.</li>
        </ul>
      </div>
    </div>
  </footer>

  <!-- End Footer -->

  <!-- Begin Mobile Menu -->

  <div class="mobile-main-menu">
    <div class="container-fluid">
      <div class="container">
        <div class="mobile-main-menu-header-container">
          <a class="header-logo" href="https://pytorch.kr/" aria-label="PyTorch"></a>
          <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu"></a>
        </div>
      </div>
    </div>

    <div class="mobile-main-menu-links-container">
      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pytorch.kr/get-started">시작하기</a>
          </li>

          <li class="active">
            <a href="https://tutorials.pytorch.kr/">튜토리얼</a>
          </li>

          <li>
            <a href="https://pytorch.kr/hub">허브</a>
          </li>

          <li>
            <a href="https://discuss.pytorch.kr/">커뮤니티</a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- End Mobile Menu -->

  <script type="text/javascript" src="../_static/js/vendor/anchor.min.js"></script>

  <script type="text/javascript">
    $(document).ready(function() {
      mobileMenu.bind();
      mobileTOC.bind();
      pytorchAnchors.bind();
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();
      mainMenuDropdown.bind();
      filterTags.bind();

      // Add class to links that have code blocks, since we cannot create links in code blocks
      $("article.pytorch-article a span.pre").each(function(e) {
        $(this).closest("a").addClass("has-code");
      });
    })
  </script>
</body>
</html>